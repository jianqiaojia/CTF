# CTFé€†å‘é¢˜è§£ - è¿·å®«å¯»è·¯æŒ‘æˆ˜

## é¢˜ç›®ä¿¡æ¯

- **éš¾åº¦**: â­â­ (2/5)
- **ç±»åˆ«**: é€†å‘å·¥ç¨‹ + è¿·å®«å¯»è·¯
- **æ–‡ä»¶**: `bdb2c015b0fd4f74bc4c3e5a6e54bcf4` (x64 Linux ELF)
- **ä¸»è¦æŠ€æœ¯**: å­—ç¬¦ä¸²å¤„ç†ã€åæ ‡ç³»ç»Ÿã€BFSå¯»è·¯

---

## è§£é¢˜æ€è·¯

### ç¬¬ä¸€æ­¥ï¼šåˆæ­¥åˆ†æ

æ‰“å¼€IDAæŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œå‘ç°å…³é”®çº¿ç´¢ï¼š

```
"Input flag:"
"nctf{"
"  *******   *  **** * ****  * ***  *#  *** *** ***     *********"  â† è¿·å®«æ•°æ®ï¼
```

**å…³é”®å‘ç°1**: 64å­—èŠ‚æ•°æ®æ˜¯8Ã—8è¿·å®«ï¼ŒåŒ…å«ç©ºæ ¼(è·¯å¾„)ã€æ˜Ÿå·(å¢™)å’Œäº•å·(ç›®æ ‡)

### ç¬¬äºŒæ­¥ï¼šåˆ†æmainå‡½æ•°

åç¼–è¯‘mainå‡½æ•°ï¼Œå‘ç°éªŒè¯é€»è¾‘ï¼š

```c
v10[0] = 0;    // åˆå§‹åŒ– x åæ ‡
v9 = 0;        // åˆå§‹åŒ– y åæ ‡

// éªŒè¯flagæ ¼å¼
if ( strlen(&s1) != 24 || strncmp(&s1, "nctf{", 5uLL) || s1[24] != '}' )
    puts("Wrong flag!");
```

**å…³é”®å‘ç°2**: Flagæ ¼å¼ = `nctf{` + 18å­—ç¬¦è·¯å¾„ + `}` = 24å­—ç¬¦

### ç¬¬ä¸‰æ­¥ï¼šåˆ†æç§»åŠ¨å‡½æ•°

å‘ç°4ä¸ªç§»åŠ¨å‡½æ•°å¯¹åº”ä¸åŒå­—ç¬¦ï¼š

```c
// sub_400650 - å­—ç¬¦ 'O'
bool sub_400650(_DWORD *a1) {
  int v1 = (*a1)--;     // xåæ ‡å‡1
  return v1 > 0;
}

// sub_400660 - å­—ç¬¦ 'o'  
bool sub_400660(int *a1) {
  *a1 = *a1 + 1;        // xåæ ‡åŠ 1
  return *a1 < 8;
}

// sub_400670 - å­—ç¬¦ '.'
bool sub_400670(_DWORD *a1) {
  int v1 = (*a1)--;     // yåæ ‡å‡1
  return v1 > 0;
}

// sub_400680 - å­—ç¬¦ '0'
bool sub_400680(int *a1) {
  *a1 = *a1 + 1;        // yåæ ‡åŠ 1
  return *a1 < 8;
}
```

**å…³é”®å‘ç°3**: ç§»åŠ¨å‘½ä»¤æ˜ å°„

| å­—ç¬¦ | å‡½æ•° | æ“ä½œ | æ–¹å‘ |
|------|------|------|------|
| `O` | `sub_400650` | `x--` | å‘å·¦ |
| `o` | `sub_400660` | `x++` | å‘å³ |
| `.` | `sub_400670` | `y--` | å‘ä¸Š |
| `0` | `sub_400680` | `y++` | å‘ä¸‹ |

### ç¬¬å››æ­¥ï¼šåˆ†æéªŒè¯é€»è¾‘

```c
__int64 __fastcall sub_400690(__int64 a1, int a2, int a3)
{
  result = *(unsigned __int8 *)(a1 + a2 + 8LL * a3);
  LOBYTE(result) = result == 32 || result == 35;  // ç©ºæ ¼æˆ–äº•å·
  return result;
}
```

è®¿é—®å…¬å¼ï¼š`position = x + 8 * y`ï¼Œå…¶ä¸­ `a2=v10[0]=x`, `a3=v9=y`

**å…³é”®å‘ç°4**: è¿·å®«æ˜¯8åˆ—å¸ƒå±€ï¼Œæ£€æŸ¥ä½ç½®æ˜¯å¦ä¸ºç©ºæ ¼(0x20)æˆ–äº•å·(0x23)

### ç¬¬äº”æ­¥ï¼šè§£æè¿·å®«å¸ƒå±€

ä»0x601060æå–64å­—èŠ‚ï¼ŒæŒ‰8åˆ—æ‹†åˆ†ï¼š

```
      x=0 1 2 3 4 5 6 7
y=0:  [' ',' ','*','*','*','*','*','*']  â† èµ·ç‚¹(0,0)
y=1:  ['*',' ',' ',' ','*',' ',' ','*']
y=2:  ['*','*','*',' ','*',' ','*','*']
y=3:  ['*','*',' ',' ','*',' ','*','*']
y=4:  ['*',' ',' ','*','#',' ',' ','*']  â† ç›®æ ‡(4,4)
y=5:  ['*','*',' ','*','*','*',' ','*']
y=6:  ['*','*',' ',' ',' ',' ',' ','*']
y=7:  ['*','*','*','*','*','*','*','*']  â† å…¨æ˜¯å¢™
```

**å…³é”®å‘ç°5**: ä»(0,0)åˆ°(4,4)éœ€è¦æ‰¾ä¸€æ¡18æ­¥çš„è·¯å¾„

### ç¬¬å…­æ­¥ï¼šå¸¸è§é”™è¯¯

**é”™è¯¯1**: åæ ‡ç³»ç»Ÿæ··æ·†
```
âŒ ç†è§£æˆ maze[x][y]
âœ… æ­£ç¡®æ˜¯ position = x + 8*yï¼Œxæ˜¯åˆ—ï¼Œyæ˜¯è¡Œ
```

**é”™è¯¯2**: è¾¹ç•Œåˆ¤æ–­
```
âŒ y < 8  # å…è®¸è®¿é—®Row 7
âœ… y < 7  # Row 7å…¨æ˜¯å¢™ï¼Œä¸å¯è®¿é—®
```

### ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨BFSç®—æ³•å¯»è·¯

```python
from collections import deque

def find_path():
    queue = deque([(0, 0, "")])  # (x, y, path)
    visited = set([(0, 0)])
    
    directions = {
        'O': (-1, 0), 'o': (1, 0),   # å·¦å³
        '.': (0, -1), '0': (0, 1)    # ä¸Šä¸‹
    }
    
    while queue:
        x, y, path = queue.popleft()
        
        if (x, y) == (4, 4):  # åˆ°è¾¾ç›®æ ‡
            return path
        
        if len(path) >= 20:
            continue
            
        for move, (dx, dy) in directions.items():
            nx, ny = x + dx, y + dy
            
            if 0 <= nx < 8 and 0 <= ny < 7 and (nx, ny) not in visited:
                if maze[ny][nx] in [' ', '#']:
                    visited.add((nx, ny))
                    queue.append((nx, ny, path + move))
    
    return None
```

è¿è¡ŒBFSå¾—åˆ°è·¯å¾„ï¼š`0ooo0o0ooo0oo0Oooo` (18å­—ç¬¦)

---

## å®Œæ•´è§£å¯†è„šæœ¬

```python
#!/usr/bin/env python3
from collections import deque

def solve_flag():
    # è¿·å®«æ•°æ®
    maze = [
        "  ******",  # y=0
        "*   *  *",  # y=1
        "*** * **",  # y=2
        "**  * **",  # y=3
        "*  *#  *",  # y=4
        "** *** *",  # y=5
        "**     *",  # y=6
        "********"   # y=7
    ]
    
    # BFSå¯»è·¯
    queue = deque([(0, 0, "")])
    visited = set([(0, 0)])
    directions = {'O': (-1,0), 'o': (1,0), '.': (0,-1), '0': (0,1)}
    
    while queue:
        x, y, path = queue.popleft()
        
        if (x, y) == (4, 4):
            flag = f"nctf{{{path}}}"
            print(f"Flag: {flag}")
            return flag
        
        if len(path) >= 20:
            continue
            
        for move, (dx, dy) in directions.items():
            nx, ny = x + dx, y + dy
            if 0 <= nx < 8 and 0 <= ny < 7 and (nx, ny) not in visited:
                if maze[ny][nx] in [' ', '#']:
                    visited.add((nx, ny))
                    queue.append((nx, ny, path + move))
    
    return None

if __name__ == "__main__":
    solve_flag()
```

---

## æœ€ç»ˆç­”æ¡ˆ

### FLAG
```
nctf{0ooo0o0ooo0oo0Oooo}
```

### æŠ€æœ¯è¦ç‚¹

1. **åæ ‡ç³»ç»Ÿ**: `position = x + 8*y`ï¼Œå…¶ä¸­xæ˜¯åˆ—(0-7)ï¼Œyæ˜¯è¡Œ(0-6)
2. **ç§»åŠ¨å‘½ä»¤**: O(å·¦) o(å³) .(ä¸Š) 0(ä¸‹)
3. **éªŒè¯é€»è¾‘**: æ¯æ­¥ç§»åŠ¨åæ£€æŸ¥æ˜¯å¦åœ¨ç©ºåœ°æˆ–ç›®æ ‡ä¸Šï¼Œæœ€åå¿…é¡»åœåœ¨äº•å·ä½ç½®
4. **ç®—æ³•é€‰æ‹©**: BFSä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯å¾„

### å…³é”®å˜é‡ï¼ˆæ¥è‡ªä¼ªä»£ç ï¼‰

- `v10[0]`: xåæ ‡
- `v9`: yåæ ‡  
- `v3`: å¾ªç¯è®¡æ•°å™¨ï¼Œéå†flagå­—ç¬¦
- `v4`: å½“å‰ç§»åŠ¨å­—ç¬¦
- `v5`: ç§»åŠ¨å‡½æ•°è¿”å›å€¼

---

**Happy Reversing! ğŸš€**