#include <ctype.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

#define MAX_NAME 64
#define KEY_SIZE 64

void flip_case(char *str) {
  for (int i = 0; str[i] != '\0'; i++) {
    if (isupper(str[i])) {
      str[i] = tolower(str[i]);
    } else if (islower(str[i])) {
      str[i] = toupper(str[i]);
    }
  }
}

int main(void) {
  // Disable buffering for smooth I/O
  setvbuf(stdin, NULL, _IONBF, 0);
  setvbuf(stdout, NULL, _IONBF, 0);

  char super_secret_open_ai_api_key_powering_the_flipper[KEY_SIZE];

  char output[MAX_NAME];
  char input_buffer[MAX_NAME];

  memset(output, 0, MAX_NAME);
  memset(input_buffer, 0, MAX_NAME);

  FILE *key = fopen("flag.txt", "r");
  if (!key) {
    puts("Ughhh! This should seriously never happen!");
    return 1;
  }

  if (!fgets(super_secret_open_ai_api_key_powering_the_flipper, KEY_SIZE,
             key)) {
    fclose(key);
    puts("Looks like the tokens drained our budget - womp womp!");
    return 1;
  }
  fclose(key);

  puts("=================================");
  puts("   Welcome to FlipCase AIâ„¢      ");
  puts("=================================");
  puts("");
  puts("ðŸš€ Leveraging cutting-edge machine learning algorithms");
  puts("to disrupt the case-conversion space with our");
  puts("AI-powered, next-gen transformation platform at scale!");
  puts("");
  puts("This program will flip the case of your name.");
  puts("");
  printf("Please enter your name: ");
  read(STDIN_FILENO, input_buffer, MAX_NAME);

  puts("");
  puts("Getting ready to flip the case of your name...");

  strncpy(output, input_buffer, MAX_NAME);
  flip_case(output);

  printf("Your flipped name is: %s\n", output);
  puts("");
  puts("Have a great day!");

  return 0;
}
